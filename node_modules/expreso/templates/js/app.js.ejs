
const express = require('express')
const app = express()
  .set('json spaces', 2)
  .use(express.json())
  .set('port', process.env.PORT || 5555)
  <%if (args.view) { -%>
    .set('views', require('path').join(__dirname, 'views'))
    .set('view engine', 'ejs')
    .get('/ejs', (req, res) => res.render('index', { title: 'Title', users: Array(10).map((_, i) => ({ name: `User ${i}`, age: i })) }))
  <%}-%>
  .get('/', (req, res) => (res.type('html').status(200).end(`<h1>Sample Page</h1>`)))
  .get('/json', (req, res) => res.json({ url: `${req.protocol}://${req.get('host')}${req.originalUrl}` }))
  .all('/echo/:foo?', echo)
 <%- include(`js/partials/list-endpoints.js.ejs`)%>

<%- include(`js/middle/middle.js.ejs`)%>

<%if (args.logs) {%>
<%- include(`js/errors/logs.js.ejs`)%>
<%}%>

<%if (!args.noErrors) {%>
<%- include(`js/errors/errors.js.ejs`)%>
<%}%>


<%if (args.https) {%>
 <%- include(`js/https/https.js.ejs`)%>
<%} else {%>
const serv = require('http').createServer(app);
<%}%>
serv.listen(app.get('port'),
  () => console.log(`listen http://localhost:${JSON.stringify(serv.address().port)}`)
);

<%if (args.test) {%>
 <%- include(`js/rest/test.js.ejs`)%>
<%}%>


 <%- include(`js/partials/app-utils.js.ejs`)%>

module.exports = app;