const express = require('express')
const { PORT1, PORT2 } = process.env
const HOST = 'http://localhost'

module.exports = express.Router()
  .use(express.json())
  .get('/aggr/:userId/:petId', (req, res, next) => {
    const request = require('superagent')
    const { userId, petId } = req.params
    const req1 = request
      .get(`${HOST}}:${PORT2}/users/${userId}`)
      .then(r => r.body)

    const req2 = request
      .get(`${HOST}}:${PORT1}/pets/${petId}`)
      .then(r => r.body)
    Promise./* all */allSettled([req1, req2]).then((user, pet) => {
      res.send({ user, pet })
    }).catch(next)
  })
